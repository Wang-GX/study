RabbitMQ 设置消息的TTL(过期时间)
https://www.cnblogs.com/williamwsj/p/8108637.html

我们在RabbitMQ中发布消息时，在代码中有两种方法设置某个队列的消息过期时间：

1、针对队列来说，可以使用x-message-ttl参数设置当前队列中所有消息的过期时间，即当前队列中所有的消息过期时间都一样；

2、针对单个消息来说，在发布消息时，可以使用Expiration参数来设置单个消息的过期时间。

以上两个参数的单位都是毫秒，即1000毫秒为1秒。如果以上两个都设置，则以当前消息最短的那个过期时间为准。

//TODO 注意： 延迟队列中的消息如果被消费者监听，和普通队列一样会被立即消费。延迟指的是延迟队列中的消息只有在过期时才会被发送到死信交换机，被监听死信队列的消费者立即消费。
//TODO 监听延迟队列是没有任何意义的，要配合死信交换机和死信队列一起使用才能达到消息被延迟消费的效果。

Producer -> [Message(routingKey) -> Exchange -> Queue(TTL) ->（routingKey->新的routingKey）-> DeadExchange -> DeadQueue -> Message] -> Consumer
流程说明：
绑定普通交换机和延迟队列(设置TTL：重要)
设置延迟队列中的死信消息要发送到的死信交换机，以及发送消息时的新routingKey(重要)
绑定死信交换机和死信队列(普通的交换机和队列)
(1)生产者将带有routingKey的消息发送到指定的交换机
(2)交换机根据消息携带的routingKey将消息路由到绑定的特定延迟队列中
(3)消息进入倒计时
(4)消息过期，延迟队列重新设置消息的routingKey并发送到指定的死信交换机
(5)死信交换机根据消息携带的routingKey将消息路由到绑定的特定死信队列中
(6)消费者监听死信队列，获取并消费消息